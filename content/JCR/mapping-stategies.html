
<!-- 
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE- 2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License. 
-->

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <TITLE>Mapping Stategies</TITLE>
    <LINK type="text/css" rel="stylesheet" href="http://jackrabbit.apache.org/style/site.css">
  <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY>
    <DIV id="page">
      <DIV id="header">
        <P id="jcr"><A href="http://jackrabbit.apache.org/"><IMG src="http://jackrabbit.apache.org/style/jlogo.gif" alt="Apache Jackrabbit" height="100" width="336"></A></P>
        <P id="asf"><A href="http://www.apache.org/"><IMG src="http://jackrabbit.apache.org/style/asf-logo.gif" alt="Apache Software Foundation" height="100" width="387"></A></P>
      </DIV>
      <DIV id="body">
        <DIV id="navigation">
  <UL>
	<LI>Apache Jackrabbit
	<UL>
		<LI><A href="welcome-to-apache-jackrabbit.html" title="Welcome to Apache Jackrabbit">Welcome</A></LI>
		<LI><A href="downloads.html" title="Downloads">Downloads</A></LI>
		<LI><A href="frequently-asked-questions.html" title="Frequently Asked Questions">FAQ</A></LI>
		<LI><A href="http://wiki.apache.org/jackrabbit/FrontPage" class="external-link">Jackrabbit Wiki</A></LI>
		<LI><A href="jackrabbit-history.html" title="Jackrabbit History">Jackrabbit History</A></LI>
	</UL>
	</LI>
	<LI>Documentation
	<UL>
		<LI><A href="getting-started-with-apache-jackrabbit.html" title="Getting Started with Apache Jackrabbit">Getting Started</A></LI>
		<LI><A href="standalone-server.html" title="Standalone Server">Standalone Server</A></LI>
		<LI><A href="jackrabbit-components.html" title="Jackrabbit Components">Jackrabbit Components</A></LI>
		<LI><A href="first-hops.html" title="First Hops">First Hops</A></LI>
		<LI><A href="jcr-api.html" title="JCR & API">JCR &amp; API</A></LI>
		<LI><A href="jackrabbit-architecture.html" title="Jackrabbit Architecture">Jackrabbit Architecture</A></LI>
		<LI><A href="deployment-models.html" title="Deployment Models">Deployment Models</A></LI>
		<LI><A href="jackrabbit-configuration.html" title="Jackrabbit Configuration">Jackrabbit Configuration</A></LI>
		<LI><A href="node-types.html" title="Node Types">Node Types</A></LI>
		<LI><A href="object-content-mapping.html" title="Object Content Mapping">Object Content Mapping</A></LI>
	</UL>
	</LI>
	<LI>Development
	<UL>
		<LI><A href="jackrabbit-team.html" title="Jackrabbit Team">Jackrabbit Team</A></LI>
		<LI><A href="jackrabbit-roadmap.html" title="Jackrabbit Roadmap">Jackrabbit Roadmap</A></LI>
		<LI><A href="building-jackrabbit.html" title="Building Jackrabbit">Building Jackrabbit</A></LI>
		<LI><A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
		<LI><A href="issue-tracker.html" title="Issue Tracker">Issue Tracker</A></LI>
		<LI><A href="source-repository.html" title="Source Repository">Source Repository</A></LI>
		<LI><A href="continuous-integration.html" title="Continuous Integration">Continuous Integration</A></LI>
		<LI><A href="website.html" title="Website">Website</A></LI>
		<LI><A href="creating-releases.html" title="Creating Releases">Creating Releases</A></LI>
		<LI><A href="supporting-software-attribution.html" title="Supporting software attribution">Attribution</A></LI>
	</UL>
	</LI>
	<LI>Apache Software Foundation
	<UL>
		<LI><A href="http://www.apache.org/foundation/how-it-works.html" class="external-link">Introduction</A></LI>
		<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link">Sponsorship</A></LI>
		<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link">Current Sponsors</A></LI>
	</UL>
	</LI>
</UL>
        </DIV>
        <DIV id="content">
          <H1>Mapping Stategies</H1>
  <P>We are calling &quot;Mapping strategy&quot; the algorithm used by the Persistence Manager to map a Java class into JCR nodes and/or properties.</P>

<H2><A name="MappingStategies-TheObjectModel"></A>The Object Model</H2>

<P>In order to explain the basic mapping strategies, we will use the following simple object model :</P>

<UL>
	<LI>A page contains a path (of course), a pageInfo and a collection of paragraphs.</LI>
	<LI>The PageInfo class contains the title and the page description. We are using the pageInfo here to see all mapping features (see the bean-descriptors). In real application, this class is not necessary <IMG class="emoticon" src="https://cwiki.apache.org/confluence/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"></LI>
	<LI>Each paragraph contains a path and a text field.</LI>
</UL>


<DIV class="" align="center"><SPAN class="image-wrap" style=""><IMG src="mapping-stategies.data/sample-model-doc.png" style="border: 0px solid black"></SPAN></DIV>


<P>This object model could be too simple for real applications and it is just used here to simplify the description of the different mapping strategies.</P>

<H2><A name="MappingStategies-TheJavaClasses"></A>The Java Classes</H2>

<P>Based on that object model, we can define the following Java classes:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Page.java</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class Page
{
  <SPAN class="code-object">String</SPAN> path;
  PageInfo pageInfo;
  Collection paragraphs;

  /*  Add here the getter and setter methods */

  <SPAN class="code-keyword">public</SPAN> void addParagraph(Paragraph paragraph)
  {
    <SPAN class="code-keyword">if</SPAN> (paragraphs == <SPAN class="code-keyword">null</SPAN>)
    {
      paragraphs = <SPAN class="code-keyword">new</SPAN> ArrayList();
    }

    paragraphs.add(paragraph);
  }
}
</PRE>
</DIV></DIV>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>PageInfo.java</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class PageInfo
{
  <SPAN class="code-object">String</SPAN> path;
  <SPAN class="code-object">String</SPAN> title;
  <SPAN class="code-object">String</SPAN> description;

  /*  Add here the getter and setter methods */

}
</PRE>
</DIV></DIV>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Paragraph.java</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class Paragraph
{
  <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> path;
  <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> text;

  /* Add here the getter and setter methods */

}
</PRE>
</DIV></DIV>

<H2><A name="MappingStategies-TheJCRStructure"></A>The JCR Structure</H2>

<P>Here is the resulting JCR structure if the page is stored on the path &quot;/mysite/mypage1&quot; and contains 2 paragraphs:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
/mysite/page1
  /mysite/page1/pageInfo
    my:title = <SPAN class="code-quote">&quot;This is my page title&quot;</SPAN>
    my:description = <SPAN class="code-quote">&quot;This is my page description&quot;</SPAN>
  /mysite/page1/paragraphs
    /mysite/page1/paragraphs/paragraph1
      my:text = <SPAN class="code-quote">&quot;This is the content of para1&quot;</SPAN>
    /mysite/page1/paragraphs/paragraph2
      my:text = <SPAN class="code-quote">&quot;This is the content of para2&quot;</SPAN>
</PRE>
</DIV></DIV>

<P>It is possible to have another kind of jcr structure by using other mapping strategies. See the sections <A href="mapping-atomic-fields.html" title="Mapping Atomic Fields">Mapping Atomic Fields</A>, <A href="mapping-bean-fields.html" title="Mapping Bean Fields">Mapping Bean Fields</A>, <A href="mapping-collection-fields.html" title="Mapping Collection Fields">Mapping Collection Fields</A> to get more information on that.</P>

<H2><A name="MappingStategies-TheClassDescriptors"></A>The Class Descriptors</H2>

<P>When you decide to map a bean class, you have to create a new class descriptor entry in the Persistence Manager descriptor file. Let's start with the simplest class-descriptor:</P>

<P>This class descriptor maps the class &quot;org.apache.jackrabbit.ocm.testmodel.Paragraph&quot; into the JCR type &quot;nt:unstructured&quot;. Each field-descriptor maps one bean field into a JCR property. For example, the first field descriptor maps the java bean field &quot;text&quot; into the jcr property called &quot;myjcrtext&quot;. The second field-descriptor is a specific case because it maps the jcr node path into a bean field called &quot;path&quot; (see below the section &quot;The Path Field&quot;).</P>

<P>You can find more information on the field-descriptors in the page <A href="mapping-atomic-fields.html" title="Mapping Atomic Fields">Mapping Atomic Fields</A>.</P>

<P>It is also possible to map a bean class to a particular JCR node type by specifying the desired type in the attribute jcrType. The following class-descriptor map the class &quot;org.apache.jackrabbit.ocm.testmodel.Paragraph&quot; into the node type &quot;my:paragraph&quot;.</P>

<P>Here are the class-descriptors required to map the classes Page, PageInfo and Paragraph:</P>

<P>In order to use correctly our example class with Apache Jackrabbit, you should import the following node type definitions with the Jackrabbit API.</P>

<P>Of course, node types &quot;my:Page&quot; and &quot;my:PageInfo&quot; are also required.</P>

<P>We are currently building a node type management tools which can import the node types from the class-descriptors.</P>

<H2><A name="MappingStategies-ThePathField"></A>The Path Field</H2>

<P>Each mapped class contains a mandatory field called the &quot;path field&quot;. It contains the JCR path associated to the object. For example, the following descriptor specify the bean field &quot;myPath&quot; as the path field.</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&lt;field-descriptor fieldName=<SPAN class="code-quote">&quot;myPath&quot;</SPAN> path=<SPAN class="code-quote">&quot;<SPAN class="code-keyword">true</SPAN>&quot;</SPAN> /&gt;
</PRE>
</DIV></DIV>
        </DIV>
        <DIV id="end"></DIV>
      </DIV>
      <DIV id="footer">
        <P>
          &copy; 2004-2010 The Apache Software Foundation.
          - <A href="http://jackrabbit.apache.org/privacy-policy.html">Privacy Policy</A> -
          [<A href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=75356">edit this page</A>]
          <BR>
          Apache Jackrabbit, Jackrabbit, Apache, the Apache feather logo, and the Apache
          Jackrabbit project logo are trademarks of The Apache Software Foundation.
        </P>
      </DIV>
    </DIV>
<!-- JCR- 1315: Add Google Analytics to Jackrabbit web site -->
<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
var pageTracker = _gat._getTracker("UA-837900-2");
pageTracker._initData();
pageTracker._trackPageview();
</SCRIPT>
  </BODY>
</HTML>
