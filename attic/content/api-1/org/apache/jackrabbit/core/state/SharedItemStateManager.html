<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc -->
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<TITLE>
SharedItemStateManager (Apache Jackrabbit 1.0 API)
</TITLE>

<META NAME="keywords" CONTENT="org.apache.jackrabbit.core.state.SharedItemStateManager class">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    parent.document.title="SharedItemStateManager (Apache Jackrabbit 1.0 API)";
}
</SCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/SharedItemStateManager.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../org/apache/jackrabbit/core/state/SessionItemStateManager.html" title="class in org.apache.jackrabbit.core.state"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../../org/apache/jackrabbit/core/state/XAItemStateManager.html" title="class in org.apache.jackrabbit.core.state"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="SharedItemStateManager.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>

</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
org.apache.jackrabbit.core.state</FONT>
<BR>
Class SharedItemStateManager</H2>
<PRE>
<A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html" title="class or interface in java.lang">java.lang.Object</A>
  <IMG SRC="../../../../../resources/inherit.gif" ALT="extended by"><B>org.apache.jackrabbit.core.state.SharedItemStateManager</B>
</PRE>
<DL>
<DT><B>All Implemented Interfaces:</B> <DD><A HREF="../../../../../org/apache/jackrabbit/core/util/Dumpable.html" title="interface in org.apache.jackrabbit.core.util">Dumpable</A>, <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html" title="interface in org.apache.jackrabbit.core.state">ItemStateListener</A>, <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html" title="interface in org.apache.jackrabbit.core.state">ItemStateManager</A></DD>
</DL>
<HR>
<DL>
<DT>public class <B>SharedItemStateManager</B><DT>extends <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html" title="class or interface in java.lang">Object</A><DT>implements <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html" title="interface in org.apache.jackrabbit.core.state">ItemStateManager</A>, <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html" title="interface in org.apache.jackrabbit.core.state">ItemStateListener</A>, <A HREF="../../../../../org/apache/jackrabbit/core/util/Dumpable.html" title="interface in org.apache.jackrabbit.core.util">Dumpable</A></DL>

<P>
Shared <code>ItemStateManager</code> (SISM). Caches objects returned from a
 <code>PersistenceManager</code>. Objects returned by this item state
 manager are shared among all sessions.
 <p/>
 A shared item state manager operates on a <code>PersistenceManager</code>
 (PM) that is used to load and store the item states. Additionally, a SISM can
 have <code>VirtualItemStateProvider</code>s (VISP) that are used to provide
 additional, non-persistent, read-only states. Examples of VISP are the
 content representation of the NodeTypes (/jcr:system/jcr:nodeTypes) and the
 version store (/jcr:system/jcr:versionStore). those 2 VISP are added to the
 SISM during initialization of a workspace. i.e. they are 'mounted' to all
 workspaces. we assume, that VISP cannot be added dynamically, neither during
 runtime nor by configuration.
 <p/>
 The states from the VISP are readonly. by the exception for node references.
 remember that the referrers are stored in a <A HREF="../../../../../org/apache/jackrabbit/core/state/NodeReferences.html" title="class in org.apache.jackrabbit.core.state"><CODE>NodeReferences</CODE></A> state,
 having the ID of the target state.
 <br/>
 there are 5 types of referential relations to be distinguished:
 <ol>
 <li> normal --> normal (references from 'normal' states to 'normal' states)
      this is the normal case and will be handled by the SISM.

 <li> normal --> virtual (references from 'normal' states to 'virtual' states)
      those references should be handled by the VISP rather by the SISM.

 <li> virtual --> normal (references from 'virtual' states to 'normal' states)
      such references are not supported. eg. references of versioned nodes do
      not impose any constraints on the referenced nodes.

 <li> virtual --> virtual (references from 'virtual' states to 'virtual'
      states of the same VISP).
      intra-virtual references are handled by the item state manager of the VISP.

 <li> virtual --> virtual' (references from 'virtual' states to 'virtual'
      states of different VISP).
      those do currently not occurr and are therfor not supported.
 </ol>
 <p/>
 if VISP are not dynamic, there is not risk that NV-type references can dangle
 (since a VISP cannot be 'unmounted', leaving eventual references dangling).
 although multi-workspace-referrers are not explicitelt supported, the
 architecture of <code>NodeReferences</code> support multiple referrers with
 the same PropertyId. So the number of references can be tracked (an example
 of multi-workspace-refferres is a version referenced by the jcr:baseVersion
 of several (corresponding) nodes in multiple workspaces).
 <br/>
 As mentioned, VN-type references should not impose any constraints on the
 referrers (e.g. a normal node referenced by a versioned reference property).
 In case of the version store, the VN-type references are not stored at
 all, but reinforced as NN-type references in the normal states in case of a
 checkout operation.
 <br/>
 VV-type references should be handled by the respective VISP. they look as
 NN-type references in the scope if the VISP anyway...so no special treatment
 should be neccessairy.
 <br/>
 VV'-type references are currently not possible, since the version store and
 virtual nodetype representation don't allow such references.
<P>

<P>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->


<!-- =========== FIELD SUMMARY =========== -->


<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#SharedItemStateManager(org.apache.jackrabbit.core.state.PersistenceManager, org.apache.jackrabbit.core.NodeId, org.apache.jackrabbit.core.nodetype.NodeTypeRegistry, boolean)">SharedItemStateManager</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/PersistenceManager.html" title="interface in org.apache.jackrabbit.core.state">PersistenceManager</A>&nbsp;persistMgr,
                       <A HREF="../../../../../org/apache/jackrabbit/core/NodeId.html" title="class in org.apache.jackrabbit.core">NodeId</A>&nbsp;rootNodeId,
                       <A HREF="../../../../../org/apache/jackrabbit/core/nodetype/NodeTypeRegistry.html" title="class in org.apache.jackrabbit.core.nodetype">NodeTypeRegistry</A>&nbsp;ntReg,
                       boolean&nbsp;usesReferences)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Creates a new <code>SharedItemStateManager</code> instance.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Method Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#addVirtualItemStateProvider(org.apache.jackrabbit.core.virtual.VirtualItemStateProvider)">addVirtualItemStateProvider</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/virtual/VirtualItemStateProvider.html" title="interface in org.apache.jackrabbit.core.virtual">VirtualItemStateProvider</A>&nbsp;prov)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adds a new virtual item state provider.<p/>
 NOTE: This method is not synchronized, because it is called right after
 creation only by the same thread and therefore concurrency issues
 do not occur.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;org.apache.jackrabbit.core.state.SharedItemStateManager.Update</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#beginUpdate(org.apache.jackrabbit.core.state.ChangeLog, org.apache.jackrabbit.core.observation.EventStateCollectionFactory, org.apache.jackrabbit.core.virtual.VirtualItemStateProvider)">beginUpdate</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ChangeLog.html" title="class in org.apache.jackrabbit.core.state">ChangeLog</A>&nbsp;local,
            <A HREF="../../../../../org/apache/jackrabbit/core/observation/EventStateCollectionFactory.html" title="interface in org.apache.jackrabbit.core.observation">EventStateCollectionFactory</A>&nbsp;factory,
            <A HREF="../../../../../org/apache/jackrabbit/core/virtual/VirtualItemStateProvider.html" title="interface in org.apache.jackrabbit.core.virtual">VirtualItemStateProvider</A>&nbsp;virtualProvider)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Begin update operation.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#checkReferentialIntegrity(org.apache.jackrabbit.core.state.ChangeLog)">checkReferentialIntegrity</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ChangeLog.html" title="class in org.apache.jackrabbit.core.state">ChangeLog</A>&nbsp;changes)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verifies that
 
 no referenceable nodes are deleted if they are still being referenced
 targets of modified node references exist
 </TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#dispose()">dispose</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disposes this <code>SharedItemStateManager</code> and frees resources.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#dump(java.io.PrintStream)">dump</A></B>(<A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/io/PrintStream.html" title="class or interface in java.io">PrintStream</A>&nbsp;ps)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dumps the state of this instance in a human readable format for
 diagnostic purposes.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#getItemState(org.apache.jackrabbit.core.ItemId)">getItemState</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/ItemId.html" title="class in org.apache.jackrabbit.core">ItemId</A>&nbsp;id)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return an item state, given its item id.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../../../org/apache/jackrabbit/core/state/NodeReferences.html" title="class in org.apache.jackrabbit.core.state">NodeReferences</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#getNodeReferences(org.apache.jackrabbit.core.state.NodeReferencesId)">getNodeReferences</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/NodeReferencesId.html" title="class in org.apache.jackrabbit.core.state">NodeReferencesId</A>&nbsp;id)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return a node references object, given its target id</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#hasItemState(org.apache.jackrabbit.core.ItemId)">hasItemState</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/ItemId.html" title="class in org.apache.jackrabbit.core">ItemId</A>&nbsp;id)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return a flag indicating whether an item state for a given
 item id exists.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#hasNodeReferences(org.apache.jackrabbit.core.state.NodeReferencesId)">hasNodeReferences</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/NodeReferencesId.html" title="class in org.apache.jackrabbit.core.state">NodeReferencesId</A>&nbsp;id)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return a flag indicating whether a node references object
 for a given target id exists.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#stateCreated(org.apache.jackrabbit.core.state.ItemState)">stateCreated</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A>&nbsp;created)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Called when an <code>ItemState</code> has successfully
 been created (i.e. its underlying persistent state was created).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#stateDestroyed(org.apache.jackrabbit.core.state.ItemState)">stateDestroyed</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A>&nbsp;destroyed)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Called when an <code>ItemState</code> has successfully been
 removed (i.e. its underlying persistent state has been destroyed).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#stateDiscarded(org.apache.jackrabbit.core.state.ItemState)">stateDiscarded</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A>&nbsp;discarded)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Called when an <code>ItemState</code> has been discarded (i.e. it has
 been rendered 'invalid').</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#stateModified(org.apache.jackrabbit.core.state.ItemState)">stateModified</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A>&nbsp;modified)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Called when an <code>ItemState</code> has successfully
 been modified (i.e. its underlying persistent state has changed).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#update(org.apache.jackrabbit.core.state.ChangeLog, org.apache.jackrabbit.core.observation.EventStateCollectionFactory)">update</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ChangeLog.html" title="class in org.apache.jackrabbit.core.state">ChangeLog</A>&nbsp;local,
       <A HREF="../../../../../org/apache/jackrabbit/core/observation/EventStateCollectionFactory.html" title="interface in org.apache.jackrabbit.core.observation">EventStateCollectionFactory</A>&nbsp;factory)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Store modifications registered in a <code>ChangeLog</code>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../org/apache/jackrabbit/core/state/SharedItemStateManager.html#updateReferences(org.apache.jackrabbit.core.state.ChangeLog, org.apache.jackrabbit.core.virtual.VirtualItemStateProvider)">updateReferences</A></B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ChangeLog.html" title="class in org.apache.jackrabbit.core.state">ChangeLog</A>&nbsp;changes,
                 <A HREF="../../../../../org/apache/jackrabbit/core/virtual/VirtualItemStateProvider.html" title="interface in org.apache.jackrabbit.core.virtual">VirtualItemStateProvider</A>&nbsp;virtualProvider)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Updates the target node references collections based on the modifications
 in the change log (i.e.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TD><B>Methods inherited from class java.lang.<A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html" title="class or interface in java.lang">Object</A></B></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#clone()" title="class or interface in java.lang">clone</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang">equals</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#finalize()" title="class or interface in java.lang">finalize</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#getClass()" title="class or interface in java.lang">getClass</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#hashCode()" title="class or interface in java.lang">hashCode</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#notify()" title="class or interface in java.lang">notify</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#notifyAll()" title="class or interface in java.lang">notifyAll</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#toString()" title="class or interface in java.lang">toString</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#wait()" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#wait(long)" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#wait(long, int)" title="class or interface in java.lang">wait</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->


<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=1><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TD>
</TR>
</TABLE>

<A NAME="SharedItemStateManager(org.apache.jackrabbit.core.state.PersistenceManager, org.apache.jackrabbit.core.NodeId, org.apache.jackrabbit.core.nodetype.NodeTypeRegistry, boolean)"><!-- --></A><H3>
SharedItemStateManager</H3>
<PRE>
public <B>SharedItemStateManager</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/PersistenceManager.html" title="interface in org.apache.jackrabbit.core.state">PersistenceManager</A>&nbsp;persistMgr,
                              <A HREF="../../../../../org/apache/jackrabbit/core/NodeId.html" title="class in org.apache.jackrabbit.core">NodeId</A>&nbsp;rootNodeId,
                              <A HREF="../../../../../org/apache/jackrabbit/core/nodetype/NodeTypeRegistry.html" title="class in org.apache.jackrabbit.core.nodetype">NodeTypeRegistry</A>&nbsp;ntReg,
                              boolean&nbsp;usesReferences)
                       throws <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></PRE>
<DL>
<DD>Creates a new <code>SharedItemStateManager</code> instance.
<P>
<DT><B>Parameters:</B><DD><CODE>persistMgr</CODE> - <DD><CODE>rootNodeId</CODE> - <DD><CODE>ntReg</CODE> - </DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=1><FONT SIZE="+2">
<B>Method Detail</B></FONT></TD>
</TR>
</TABLE>

<A NAME="getItemState(org.apache.jackrabbit.core.ItemId)"><!-- --></A><H3>
getItemState</H3>
<PRE>
public <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A> <B>getItemState</B>(<A HREF="../../../../../org/apache/jackrabbit/core/ItemId.html" title="class in org.apache.jackrabbit.core">ItemId</A>&nbsp;id)
                       throws <A HREF="../../../../../org/apache/jackrabbit/core/state/NoSuchItemStateException.html" title="class in org.apache.jackrabbit.core.state">NoSuchItemStateException</A>,
                              <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></PRE>
<DL>
<DD>Return an item state, given its item id.
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html#getItemState(org.apache.jackrabbit.core.ItemId)">getItemState</A></CODE> in interface <CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html" title="interface in org.apache.jackrabbit.core.state">ItemStateManager</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>id</CODE> - item id
<DT><B>Returns:</B><DD>item state
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/NoSuchItemStateException.html" title="class in org.apache.jackrabbit.core.state">NoSuchItemStateException</A></CODE> - if the item does not exist
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></CODE> - if an error occurs</DL>
</DD>
</DL>
<HR>

<A NAME="hasItemState(org.apache.jackrabbit.core.ItemId)"><!-- --></A><H3>
hasItemState</H3>
<PRE>
public boolean <B>hasItemState</B>(<A HREF="../../../../../org/apache/jackrabbit/core/ItemId.html" title="class in org.apache.jackrabbit.core">ItemId</A>&nbsp;id)</PRE>
<DL>
<DD>Return a flag indicating whether an item state for a given
 item id exists.
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html#hasItemState(org.apache.jackrabbit.core.ItemId)">hasItemState</A></CODE> in interface <CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html" title="interface in org.apache.jackrabbit.core.state">ItemStateManager</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>id</CODE> - item id
<DT><B>Returns:</B><DD><code>true</code> if an item state exists,
         otherwise <code>false</code></DL>
</DD>
</DL>
<HR>

<A NAME="getNodeReferences(org.apache.jackrabbit.core.state.NodeReferencesId)"><!-- --></A><H3>
getNodeReferences</H3>
<PRE>
public <A HREF="../../../../../org/apache/jackrabbit/core/state/NodeReferences.html" title="class in org.apache.jackrabbit.core.state">NodeReferences</A> <B>getNodeReferences</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/NodeReferencesId.html" title="class in org.apache.jackrabbit.core.state">NodeReferencesId</A>&nbsp;id)
                                 throws <A HREF="../../../../../org/apache/jackrabbit/core/state/NoSuchItemStateException.html" title="class in org.apache.jackrabbit.core.state">NoSuchItemStateException</A>,
                                        <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></PRE>
<DL>
<DD>Return a node references object, given its target id
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html#getNodeReferences(org.apache.jackrabbit.core.state.NodeReferencesId)">getNodeReferences</A></CODE> in interface <CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html" title="interface in org.apache.jackrabbit.core.state">ItemStateManager</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>id</CODE> - target id
<DT><B>Returns:</B><DD>node references object
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></CODE> - if an error occurs
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/NoSuchItemStateException.html" title="class in org.apache.jackrabbit.core.state">NoSuchItemStateException</A></CODE> - if the item does not exist</DL>
</DD>
</DL>
<HR>

<A NAME="hasNodeReferences(org.apache.jackrabbit.core.state.NodeReferencesId)"><!-- --></A><H3>
hasNodeReferences</H3>
<PRE>
public boolean <B>hasNodeReferences</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/NodeReferencesId.html" title="class in org.apache.jackrabbit.core.state">NodeReferencesId</A>&nbsp;id)</PRE>
<DL>
<DD>Return a flag indicating whether a node references object
 for a given target id exists.
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html#hasNodeReferences(org.apache.jackrabbit.core.state.NodeReferencesId)">hasNodeReferences</A></CODE> in interface <CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateManager.html" title="interface in org.apache.jackrabbit.core.state">ItemStateManager</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>id</CODE> - target id
<DT><B>Returns:</B><DD><code>true</code> if a node reference object exists for the given
         id, otherwise <code>false</code>.</DL>
</DD>
</DL>
<HR>

<A NAME="stateCreated(org.apache.jackrabbit.core.state.ItemState)"><!-- --></A><H3>
stateCreated</H3>
<PRE>
public void <B>stateCreated</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A>&nbsp;created)</PRE>
<DL>
<DD>Called when an <code>ItemState</code> has successfully
 been created (i.e. its underlying persistent state was created).
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html#stateCreated(org.apache.jackrabbit.core.state.ItemState)">stateCreated</A></CODE> in interface <CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html" title="interface in org.apache.jackrabbit.core.state">ItemStateListener</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>created</CODE> - the <code>ItemState</code> that has been 'created'</DL>
</DD>
</DL>
<HR>

<A NAME="stateModified(org.apache.jackrabbit.core.state.ItemState)"><!-- --></A><H3>
stateModified</H3>
<PRE>
public void <B>stateModified</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A>&nbsp;modified)</PRE>
<DL>
<DD>Called when an <code>ItemState</code> has successfully
 been modified (i.e. its underlying persistent state has changed).
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html#stateModified(org.apache.jackrabbit.core.state.ItemState)">stateModified</A></CODE> in interface <CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html" title="interface in org.apache.jackrabbit.core.state">ItemStateListener</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>modified</CODE> - the <code>ItemState</code> that has been 'modified'</DL>
</DD>
</DL>
<HR>

<A NAME="stateDestroyed(org.apache.jackrabbit.core.state.ItemState)"><!-- --></A><H3>
stateDestroyed</H3>
<PRE>
public void <B>stateDestroyed</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A>&nbsp;destroyed)</PRE>
<DL>
<DD>Called when an <code>ItemState</code> has successfully been
 removed (i.e. its underlying persistent state has been destroyed).
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html#stateDestroyed(org.apache.jackrabbit.core.state.ItemState)">stateDestroyed</A></CODE> in interface <CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html" title="interface in org.apache.jackrabbit.core.state">ItemStateListener</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>destroyed</CODE> - the <code>ItemState</code> that has been 'destroyed'</DL>
</DD>
</DL>
<HR>

<A NAME="stateDiscarded(org.apache.jackrabbit.core.state.ItemState)"><!-- --></A><H3>
stateDiscarded</H3>
<PRE>
public void <B>stateDiscarded</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html" title="class in org.apache.jackrabbit.core.state">ItemState</A>&nbsp;discarded)</PRE>
<DL>
<DD>Called when an <code>ItemState</code> has been discarded (i.e. it has
 been rendered 'invalid').
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html#stateDiscarded(org.apache.jackrabbit.core.state.ItemState)">stateDiscarded</A></CODE> in interface <CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateListener.html" title="interface in org.apache.jackrabbit.core.state">ItemStateListener</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>discarded</CODE> - the <code>ItemState</code> that has been discarded<DT><B>See Also:</B><DD><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemState.html#discard()"><CODE>ItemState.discard()</CODE></A></DL>
</DD>
</DL>
<HR>

<A NAME="dump(java.io.PrintStream)"><!-- --></A><H3>
dump</H3>
<PRE>
public void <B>dump</B>(<A HREF="http://java.sun.com/j2se/1.4.2/docs/api/java/io/PrintStream.html" title="class or interface in java.io">PrintStream</A>&nbsp;ps)</PRE>
<DL>
<DD>Dumps the state of this instance in a human readable format for
 diagnostic purposes.
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/util/Dumpable.html#dump(java.io.PrintStream)">dump</A></CODE> in interface <CODE><A HREF="../../../../../org/apache/jackrabbit/core/util/Dumpable.html" title="interface in org.apache.jackrabbit.core.util">Dumpable</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>ps</CODE> - stream to dump state to</DL>
</DD>
</DL>
<HR>

<A NAME="dispose()"><!-- --></A><H3>
dispose</H3>
<PRE>
public void <B>dispose</B>()</PRE>
<DL>
<DD>Disposes this <code>SharedItemStateManager</code> and frees resources.
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="addVirtualItemStateProvider(org.apache.jackrabbit.core.virtual.VirtualItemStateProvider)"><!-- --></A><H3>
addVirtualItemStateProvider</H3>
<PRE>
public void <B>addVirtualItemStateProvider</B>(<A HREF="../../../../../org/apache/jackrabbit/core/virtual/VirtualItemStateProvider.html" title="interface in org.apache.jackrabbit.core.virtual">VirtualItemStateProvider</A>&nbsp;prov)</PRE>
<DL>
<DD>Adds a new virtual item state provider.<p/>
 NOTE: This method is not synchronized, because it is called right after
 creation only by the same thread and therefore concurrency issues
 do not occur. Should this ever change, the synchronization status
 has to be re-examined.
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>prov</CODE> - </DL>
</DD>
</DL>
<HR>

<A NAME="beginUpdate(org.apache.jackrabbit.core.state.ChangeLog, org.apache.jackrabbit.core.observation.EventStateCollectionFactory, org.apache.jackrabbit.core.virtual.VirtualItemStateProvider)"><!-- --></A><H3>
beginUpdate</H3>
<PRE>
public org.apache.jackrabbit.core.state.SharedItemStateManager.Update <B>beginUpdate</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ChangeLog.html" title="class in org.apache.jackrabbit.core.state">ChangeLog</A>&nbsp;local,
                                                                                  <A HREF="../../../../../org/apache/jackrabbit/core/observation/EventStateCollectionFactory.html" title="interface in org.apache.jackrabbit.core.observation">EventStateCollectionFactory</A>&nbsp;factory,
                                                                                  <A HREF="../../../../../org/apache/jackrabbit/core/virtual/VirtualItemStateProvider.html" title="interface in org.apache.jackrabbit.core.virtual">VirtualItemStateProvider</A>&nbsp;virtualProvider)
                                                                           throws <A HREF="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/ReferentialIntegrityException.html" title="class or interface in javax.jcr">ReferentialIntegrityException</A>,
                                                                                  <A HREF="../../../../../org/apache/jackrabbit/core/state/StaleItemStateException.html" title="class in org.apache.jackrabbit.core.state">StaleItemStateException</A>,
                                                                                  <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></PRE>
<DL>
<DD>Begin update operation. This will return an object that can itself be
 ended/cancelled.
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/ReferentialIntegrityException.html" title="class or interface in javax.jcr">ReferentialIntegrityException</A></CODE>
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/StaleItemStateException.html" title="class in org.apache.jackrabbit.core.state">StaleItemStateException</A></CODE>
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></CODE></DL>
</DD>
</DL>
<HR>

<A NAME="update(org.apache.jackrabbit.core.state.ChangeLog, org.apache.jackrabbit.core.observation.EventStateCollectionFactory)"><!-- --></A><H3>
update</H3>
<PRE>
public void <B>update</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ChangeLog.html" title="class in org.apache.jackrabbit.core.state">ChangeLog</A>&nbsp;local,
                   <A HREF="../../../../../org/apache/jackrabbit/core/observation/EventStateCollectionFactory.html" title="interface in org.apache.jackrabbit.core.observation">EventStateCollectionFactory</A>&nbsp;factory)
            throws <A HREF="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/ReferentialIntegrityException.html" title="class or interface in javax.jcr">ReferentialIntegrityException</A>,
                   <A HREF="../../../../../org/apache/jackrabbit/core/state/StaleItemStateException.html" title="class in org.apache.jackrabbit.core.state">StaleItemStateException</A>,
                   <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></PRE>
<DL>
<DD>Store modifications registered in a <code>ChangeLog</code>. The items
 contained in the <tt>ChangeLog</tt> are not states returned by this
 item state manager but rather must be reconnected to items provided
 by this state manager.<p/>
 After successfully storing the states the observation manager is informed
 about the changes, if an observation manager is passed to this method.<p/>
 NOTE: This method is not synchronized, because all methods it invokes
 on instance members (such as <A HREF="../../../../../org/apache/jackrabbit/core/state/PersistenceManager.html#store(org.apache.jackrabbit.core.state.ChangeLog)"><CODE>PersistenceManager.store(org.apache.jackrabbit.core.state.ChangeLog)</CODE></A> are
 considered to be thread-safe. Should this ever change, the
 synchronization status has to be re-examined.
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>local</CODE> - change log containing local items<DD><CODE>factory</CODE> - event state collection factory
<DT><B>Throws:</B>
<DD><CODE><A HREF="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/ReferentialIntegrityException.html" title="class or interface in javax.jcr">ReferentialIntegrityException</A></CODE> - if a new or modified REFERENCE
                                       property refers to a non-existent
                                       target or if a removed node is still
                                       being referenced
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/StaleItemStateException.html" title="class in org.apache.jackrabbit.core.state">StaleItemStateException</A></CODE> - if at least one of the affected item
                                       states has become stale
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></CODE> - if another error occurs</DL>
</DD>
</DL>
<HR>

<A NAME="updateReferences(org.apache.jackrabbit.core.state.ChangeLog, org.apache.jackrabbit.core.virtual.VirtualItemStateProvider)"><!-- --></A><H3>
updateReferences</H3>
<PRE>
protected void <B>updateReferences</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ChangeLog.html" title="class in org.apache.jackrabbit.core.state">ChangeLog</A>&nbsp;changes,
                                <A HREF="../../../../../org/apache/jackrabbit/core/virtual/VirtualItemStateProvider.html" title="interface in org.apache.jackrabbit.core.virtual">VirtualItemStateProvider</A>&nbsp;virtualProvider)
                         throws <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></PRE>
<DL>
<DD>Updates the target node references collections based on the modifications
 in the change log (i.e. added/removed/modified <code>REFERENCE</code>
 properties).
 <p/>
 <b>Important node:</b> For consistency reasons this method must only be
 called <i>once</i> per change log and the change log should not be modified
 anymore afterwards.
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>changes</CODE> - change log<DD><CODE>virtualProvider</CODE> - virtual provider that may already contain a
                        node references object
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></CODE> - if an error occurs</DL>
</DD>
</DL>
<HR>

<A NAME="checkReferentialIntegrity(org.apache.jackrabbit.core.state.ChangeLog)"><!-- --></A><H3>
checkReferentialIntegrity</H3>
<PRE>
protected void <B>checkReferentialIntegrity</B>(<A HREF="../../../../../org/apache/jackrabbit/core/state/ChangeLog.html" title="class in org.apache.jackrabbit.core.state">ChangeLog</A>&nbsp;changes)
                                  throws <A HREF="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/ReferentialIntegrityException.html" title="class or interface in javax.jcr">ReferentialIntegrityException</A>,
                                         <A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></PRE>
<DL>
<DD>Verifies that
 <ul>
 <li>no referenceable nodes are deleted if they are still being referenced</li>
 <li>targets of modified node references exist</li>
 </ul>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>changes</CODE> - change log
<DT><B>Throws:</B>
<DD><CODE><A HREF="http://www.day.com/maven/jsr170/javadocs/jcr-1.0/javax/jcr/ReferentialIntegrityException.html" title="class or interface in javax.jcr">ReferentialIntegrityException</A></CODE> - if a new or modified REFERENCE
                                       property refers to a non-existent
                                       target or if a removed node is still
                                       being referenced
<DD><CODE><A HREF="../../../../../org/apache/jackrabbit/core/state/ItemStateException.html" title="class in org.apache.jackrabbit.core.state">ItemStateException</A></CODE> - if another error occurs</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=3 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/SharedItemStateManager.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../org/apache/jackrabbit/core/state/SessionItemStateManager.html" title="class in org.apache.jackrabbit.core.state"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../../org/apache/jackrabbit/core/state/XAItemStateManager.html" title="class in org.apache.jackrabbit.core.state"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="SharedItemStateManager.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>

</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>
Copyright &copy; 2004-2006 The Apache Software Foundation. All Rights Reserved.
</BODY>
</HTML>
