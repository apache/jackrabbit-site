
<!-- 
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE- 2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License. 
-->

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <TITLE>Node Type Visualization</TITLE>
    <LINK type="text/css" rel="stylesheet" href="http://jackrabbit.apache.org/style/site.css">
  <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY>
    <DIV id="page">
      <DIV id="header">
        <P id="jcr"><A href="http://jackrabbit.apache.org/"><IMG src="http://jackrabbit.apache.org/style/jlogo.gif" alt="Apache Jackrabbit" height="100" width="336"></A></P>
        <P id="asf"><A href="http://www.apache.org/"><IMG src="http://jackrabbit.apache.org/style/asf-logo.gif" alt="Apache Software Foundation" height="100" width="387"></A></P>
      </DIV>
      <DIV id="body">
        <DIV id="navigation">
  <UL>
	<LI>Apache Jackrabbit
	<UL>
		<LI><A href="welcome-to-apache-jackrabbit.html" title="Welcome to Apache Jackrabbit">Welcome</A></LI>
		<LI><A href="downloads.html" title="Downloads">Downloads</A></LI>
		<LI><A href="frequently-asked-questions.html" title="Frequently Asked Questions">FAQ</A></LI>
		<LI><A href="http://wiki.apache.org/jackrabbit/FrontPage" class="external-link">Jackrabbit Wiki</A></LI>
		<LI><A href="jackrabbit-history.html" title="Jackrabbit History">Jackrabbit History</A></LI>
	</UL>
	</LI>
	<LI>Documentation
	<UL>
		<LI><A href="getting-started-with-apache-jackrabbit.html" title="Getting Started with Apache Jackrabbit">Getting Started</A></LI>
		<LI><A href="standalone-server.html" title="Standalone Server">Standalone Server</A></LI>
		<LI><A href="jackrabbit-components.html" title="Jackrabbit Components">Jackrabbit Components</A></LI>
		<LI><A href="first-hops.html" title="First Hops">First Hops</A></LI>
		<LI><A href="jcr-api.html" title="JCR & API">JCR &amp; API</A></LI>
		<LI><A href="jackrabbit-architecture.html" title="Jackrabbit Architecture">Jackrabbit Architecture</A></LI>
		<LI><A href="deployment-models.html" title="Deployment Models">Deployment Models</A></LI>
		<LI><A href="jackrabbit-configuration.html" title="Jackrabbit Configuration">Jackrabbit Configuration</A></LI>
		<LI><A href="node-types.html" title="Node Types">Node Types</A></LI>
		<LI><A href="object-content-mapping.html" title="Object Content Mapping">Object Content Mapping</A></LI>
	</UL>
	</LI>
	<LI>Development
	<UL>
		<LI><A href="jackrabbit-team.html" title="Jackrabbit Team">Jackrabbit Team</A></LI>
		<LI><A href="jackrabbit-roadmap.html" title="Jackrabbit Roadmap">Jackrabbit Roadmap</A></LI>
		<LI><A href="building-jackrabbit.html" title="Building Jackrabbit">Building Jackrabbit</A></LI>
		<LI><A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
		<LI><A href="issue-tracker.html" title="Issue Tracker">Issue Tracker</A></LI>
		<LI><A href="source-repository.html" title="Source Repository">Source Repository</A></LI>
		<LI><A href="continuous-integration.html" title="Continuous Integration">Continuous Integration</A></LI>
		<LI><A href="website.html" title="Website">Website</A></LI>
		<LI><A href="creating-releases.html" title="Creating Releases">Creating Releases</A></LI>
		<LI><A href="supporting-software-attribution.html" title="Supporting software attribution">Attribution</A></LI>
	</UL>
	</LI>
	<LI>Apache Software Foundation
	<UL>
		<LI><A href="http://www.apache.org/foundation/how-it-works.html" class="external-link">Introduction</A></LI>
		<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link">Sponsorship</A></LI>
		<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link">Current Sponsors</A></LI>
	</UL>
	</LI>
</UL>
        </DIV>
        <DIV id="content">
          <H1>Node Type Visualization</H1>
  <P>Visualizing the Node Type Hierarchy is non-trivial, even in the case of a repository containing only the default Jackrabbit node types. Here, GraphViz can help:</P>

<P><SPAN class="image-wrap" style=""><IMG src="node-type-visualization.data/jackrabbit-nodetypes.png" style="border: 0px solid black"></SPAN><BR>
Node Type Hierarchy for Jackrabbit (<A href="node-type-visualization.data/jackrabbit-nodetypes.svg">SVG version</A>)</P>

<P>In this diagram, the rounded boxes represent node types (green for mixins, gold for primrary types), with the arrows indicating the node inheritance. The square boxes represent child node and property definitions.</P>

<P>To generate these diagrams, you will need:</P>

<OL>
	<LI>A system view export of &quot;/jcr:system/jcr:nodeTypes&quot;.</LI>
	<LI>An XSLT processor and the XSLT code below.</LI>
	<LI>The <A href="http://graphviz.org/" class="external-link">GraphViz</A> tool</LI>
</OL>


<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&lt;!--
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * <SPAN class="code-keyword">this</SPAN> work <SPAN class="code-keyword">for</SPAN> additional information regarding copyright ownership.
 * The ASF licenses <SPAN class="code-keyword">this</SPAN> file to You under the Apache License, Version 2.0
 * (the <SPAN class="code-quote">&quot;License&quot;</SPAN>); you may not use <SPAN class="code-keyword">this</SPAN> file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http:<SPAN class="code-comment">//www.apache.org/licenses/LICENSE-2.0
</SPAN> *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an <SPAN class="code-quote">&quot;AS IS&quot;</SPAN> BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License <SPAN class="code-keyword">for</SPAN> the specific language governing permissions and
 * limitations under the License.
--&gt;

&lt;!--
  A tool <SPAN class="code-keyword">for</SPAN> converting the system view of /jcr:system/jcr:nodeTypes
  to GraphViz input (see &lt;http:<SPAN class="code-comment">//www.graphviz.org/&gt;).
</SPAN>  
  Usage:
  
  1: Export <SPAN class="code-object">System</SPAN> View of /jcr:system/jcr:nodeTypes

  2: Run XSLT transformation, producing a .dot file, such as with
  
     $ saxon nt-sample.xml jcr-nodetypes-to-dot.xslt &gt; nt-sample.dot

  3: Run Graphviz, <SPAN class="code-keyword">for</SPAN> instance
  
     $ dot nt-sample.dot -Tsvg -o nt-sample.svg
     
     ...producing nt-sample.svg as output.
--&gt;

&lt;xsl:transform xmlns:xsl=<SPAN class="code-quote">&quot;http:<SPAN class="code-comment">//www.w3.org/1999/XSL/Transform&quot;</SPAN>
</SPAN>                version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN>
                xmlns:ed=<SPAN class="code-quote">&quot;http:<SPAN class="code-comment">//greenbytes.de/2002/rfcedit&quot;</SPAN>
</SPAN>                xmlns:exslt=<SPAN class="code-quote">&quot;http:<SPAN class="code-comment">//exslt.org/common&quot;</SPAN>
</SPAN>                xmlns:nt=<SPAN class="code-quote">&quot;http:<SPAN class="code-comment">//www.jcp.org/jcr/nt/1.0&quot;</SPAN>
</SPAN>                xmlns:sv=<SPAN class="code-quote">&quot;http:<SPAN class="code-comment">//www.jcp.org/jcr/sv/1.0&quot;</SPAN>
</SPAN>                xmlns:jcr=<SPAN class="code-quote">&quot;http:<SPAN class="code-comment">//www.jcp.org/jcr/1.0&quot;</SPAN>
</SPAN>&gt;

&lt;xsl:output method=<SPAN class="code-quote">&quot;text&quot;</SPAN> encoding=<SPAN class="code-quote">&quot;UTF-8&quot;</SPAN>/&gt;

&lt;xsl:template match=<SPAN class="code-quote">&quot;/&quot;</SPAN>&gt;
  &lt;xsl:text&gt;digraph {&amp;#10;&lt;/xsl:text&gt;
  &lt;xsl:text&gt;  rankdir=LR;&amp;#10;&lt;/xsl:text&gt;
  &lt;xsl:apply-templates select=<SPAN class="code-quote">&quot;<SPAN class="code-comment">//sv:node[sv:property[@sv:name='jcr:primaryType']/sv:value='nt:nodeType']&quot;</SPAN>/&gt;
</SPAN>  &lt;xsl:text&gt;}&amp;#10;&lt;/xsl:text&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=<SPAN class="code-quote">&quot;sv:node[sv:property[@sv:name='jcr:primaryType']/sv:value='nt:nodeType']&quot;</SPAN>&gt;
  &lt;xsl:text&gt;  &quot;&lt;/xsl:text&gt;
  &lt;xsl:value-of select=<SPAN class="code-quote">&quot;@sv:name&quot;</SPAN>/&gt;
  &lt;xsl:text&gt;&quot; &lt;/xsl:text&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test=<SPAN class="code-quote">&quot;sv:property[@sv:name='jcr:isMixin']/sv:value='<SPAN class="code-keyword">true</SPAN>'&quot;</SPAN>&gt;
      &lt;xsl:text&gt;[style = <SPAN class="code-quote">&quot;filled, rounded&quot;</SPAN>, fillcolor = greenyellow];&lt;/xsl:text&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
      &lt;xsl:text&gt;[style = <SPAN class="code-quote">&quot;filled, rounded&quot;</SPAN>, fillcolor = gold];&lt;/xsl:text&gt;
    &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;
  &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
  
  &lt;xsl:<SPAN class="code-keyword">for</SPAN>-each select=<SPAN class="code-quote">&quot;sv:property[@sv:name='jcr:supertypes']/sv:value&quot;</SPAN>&gt;
    &lt;xsl:text&gt;  &quot;&lt;/xsl:text&gt;
    &lt;xsl:value-of select=<SPAN class="code-quote">&quot;.&quot;</SPAN>/&gt;
    &lt;xsl:text&gt;<SPAN class="code-quote">&quot; -&gt; &quot;</SPAN>&lt;/xsl:text&gt;
    &lt;xsl:value-of select=<SPAN class="code-quote">&quot;../../@sv:name&quot;</SPAN>/&gt;
    &lt;xsl:text&gt;<SPAN class="code-quote">&quot; [dir = back, tooltip = &quot;</SPAN>supertype&quot;];&amp;#10;&lt;/xsl:text&gt;
  &lt;/xsl:<SPAN class="code-keyword">for</SPAN>-each&gt;
  
  &lt;xsl:<SPAN class="code-keyword">for</SPAN>-each select=<SPAN class="code-quote">&quot;sv:node[@sv:name='jcr:childNodeDefinition']&quot;</SPAN>&gt;
  
    &lt;xsl:variable name=<SPAN class="code-quote">&quot;name&quot;</SPAN>&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test=<SPAN class="code-quote">&quot;sv:property[@sv:name='jcr:name']&quot;</SPAN>&gt;
          &lt;xsl:value-of select=<SPAN class="code-quote">&quot;sv:property[@sv:name='jcr:name']/sv:value&quot;</SPAN>/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;*&lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:variable&gt;

    &lt;xsl:variable name=<SPAN class="code-quote">&quot;id&quot;</SPAN> select=<SPAN class="code-quote">&quot;generate-id()&quot;</SPAN>/&gt;
    
    &lt;xsl:value-of select=<SPAN class="code-quote">&quot;concat('  &amp;quot;',$id,'&amp;quot; [shape = box, style = filled, fillcolor = khaki, label=&amp;quot;',$name,'&amp;quot;] &amp;#10;')&quot;</SPAN>/&gt;
    
    &lt;xsl:text&gt;  &quot;&lt;/xsl:text&gt;
    &lt;xsl:value-of select=<SPAN class="code-quote">&quot;../@sv:name&quot;</SPAN>/&gt;
    &lt;xsl:text&gt;<SPAN class="code-quote">&quot; -&gt; &quot;</SPAN>&lt;/xsl:text&gt;
    &lt;xsl:value-of select=<SPAN class="code-quote">&quot;$id&quot;</SPAN>/&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test=<SPAN class="code-quote">&quot;sv:property[@sv:name='jcr:mandatory']/sv:value='<SPAN class="code-keyword">true</SPAN>'&quot;</SPAN>&gt;
        &lt;xsl:text&gt;<SPAN class="code-quote">&quot; [tooltip = &quot;</SPAN>is mandatory child node of&quot;, dir = back];&amp;#10;&lt;/xsl:text&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:text&gt;<SPAN class="code-quote">&quot; [style = dotted, tooltip = &quot;</SPAN>is child node of&quot;, dir = back];&amp;#10;&lt;/xsl:text&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
    
    &lt;xsl:text&gt;  &quot;&lt;/xsl:text&gt;
    &lt;xsl:value-of select=<SPAN class="code-quote">&quot;sv:property[@sv:name='jcr:requiredPrimaryTypes']/sv:value&quot;</SPAN>/&gt;
    &lt;xsl:text&gt;<SPAN class="code-quote">&quot; -&gt; &quot;</SPAN>&lt;/xsl:text&gt;
    &lt;xsl:value-of select=<SPAN class="code-quote">&quot;$id&quot;</SPAN>/&gt;
    &lt;xsl:text&gt;<SPAN class="code-quote">&quot; [dir = back, tooltip = &quot;</SPAN>has primary type&quot;];&amp;#10;&lt;/xsl:text&gt;

  &lt;/xsl:<SPAN class="code-keyword">for</SPAN>-each&gt;
  
&lt;/xsl:template&gt;

&lt;/xsl:transform&gt;
</PRE>
</DIV></DIV>
        </DIV>
        <DIV id="end"></DIV>
      </DIV>
      <DIV id="footer">
        <P>
          &copy; 2004-2010 The Apache Software Foundation.
          - <A href="http://jackrabbit.apache.org/privacy-policy.html">Privacy Policy</A> -
          [<A href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=75306">edit this page</A>]
          <BR>
          Apache Jackrabbit, Jackrabbit, Apache, the Apache feather logo, and the Apache
          Jackrabbit project logo are trademarks of The Apache Software Foundation.
        </P>
      </DIV>
    </DIV>
<!-- JCR- 1315: Add Google Analytics to Jackrabbit web site -->
<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
var pageTracker = _gat._getTracker("UA-837900-2");
pageTracker._initData();
pageTracker._trackPageview();
</SCRIPT>
  </BODY>
</HTML>
