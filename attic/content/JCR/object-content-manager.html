
<!-- 
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE- 2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License. 
-->

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <TITLE>Object Content Manager</TITLE>
    <LINK type="text/css" rel="stylesheet" href="http://jackrabbit.apache.org/style/site.css">
  <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY>
    <DIV id="page">
      <DIV id="header">
        <P id="jcr"><A href="http://jackrabbit.apache.org/"><IMG src="http://jackrabbit.apache.org/style/jlogo.gif" alt="Apache Jackrabbit" height="100" width="336"></A></P>
        <P id="asf"><A href="http://www.apache.org/"><IMG src="http://jackrabbit.apache.org/style/asf-logo.gif" alt="Apache Software Foundation" height="100" width="387"></A></P>
      </DIV>
      <DIV id="body">
        <DIV id="navigation">
  <UL>
	<LI>Apache Jackrabbit
	<UL>
		<LI><A href="welcome-to-apache-jackrabbit.html" title="Welcome to Apache Jackrabbit">Welcome</A></LI>
		<LI><A href="downloads.html" title="Downloads">Downloads</A></LI>
		<LI><A href="frequently-asked-questions.html" title="Frequently Asked Questions">FAQ</A></LI>
		<LI><A href="http://wiki.apache.org/jackrabbit/FrontPage" class="external-link">Jackrabbit Wiki</A></LI>
		<LI><A href="jackrabbit-history.html" title="Jackrabbit History">Jackrabbit History</A></LI>
	</UL>
	</LI>
	<LI>Documentation
	<UL>
		<LI><A href="getting-started-with-apache-jackrabbit.html" title="Getting Started with Apache Jackrabbit">Getting Started</A></LI>
		<LI><A href="standalone-server.html" title="Standalone Server">Standalone Server</A></LI>
		<LI><A href="jackrabbit-components.html" title="Jackrabbit Components">Jackrabbit Components</A></LI>
		<LI><A href="first-hops.html" title="First Hops">First Hops</A></LI>
		<LI><A href="jcr-api.html" title="JCR & API">JCR &amp; API</A></LI>
		<LI><A href="jackrabbit-architecture.html" title="Jackrabbit Architecture">Jackrabbit Architecture</A></LI>
		<LI><A href="deployment-models.html" title="Deployment Models">Deployment Models</A></LI>
		<LI><A href="jackrabbit-configuration.html" title="Jackrabbit Configuration">Jackrabbit Configuration</A></LI>
		<LI><A href="node-types.html" title="Node Types">Node Types</A></LI>
		<LI><A href="object-content-mapping.html" title="Object Content Mapping">Object Content Mapping</A></LI>
	</UL>
	</LI>
	<LI>Development
	<UL>
		<LI><A href="jackrabbit-team.html" title="Jackrabbit Team">Jackrabbit Team</A></LI>
		<LI><A href="jackrabbit-roadmap.html" title="Jackrabbit Roadmap">Jackrabbit Roadmap</A></LI>
		<LI><A href="building-jackrabbit.html" title="Building Jackrabbit">Building Jackrabbit</A></LI>
		<LI><A href="mailing-lists.html" title="Mailing Lists">Mailing Lists</A></LI>
		<LI><A href="issue-tracker.html" title="Issue Tracker">Issue Tracker</A></LI>
		<LI><A href="source-repository.html" title="Source Repository">Source Repository</A></LI>
		<LI><A href="continuous-integration.html" title="Continuous Integration">Continuous Integration</A></LI>
		<LI><A href="website.html" title="Website">Website</A></LI>
		<LI><A href="creating-releases.html" title="Creating Releases">Creating Releases</A></LI>
		<LI><A href="supporting-software-attribution.html" title="Supporting software attribution">Attribution</A></LI>
	</UL>
	</LI>
	<LI>Apache Software Foundation
	<UL>
		<LI><A href="http://www.apache.org/foundation/how-it-works.html" class="external-link">Introduction</A></LI>
		<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link">Sponsorship</A></LI>
		<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link">Current Sponsors</A></LI>
	</UL>
	</LI>
</UL>
        </DIV>
        <DIV id="content">
          <H1>Object Content Manager</H1>
  <P>The main component in the OCM framework is the ObjectContentManager. It converts an object graph into JCR nodes and properties and vice versa. The ObjectContentManager is always associated with a JCR Session. It is used to retrieve, create, update and delete objects from a JCR content repository. Usually there is one ObjectContentManager per user session.</P>

<P>This page describes how an ObjectContentManager is working and how it can be initialised in your applications. </P>

<H2><A name="ObjectContentManager-HowdoestheObjectContentManagerwork%3F"></A>How does the Object Content Manager work ?</H2>

<P>Thanks to a Mapping Descriptor, the ObjectContentManager is able to use the appropriate mapping strategy for each persistent object (pojo). The Mapping Descriptor contains one Class Descriptor per persistent class. Each Class Descriptor contains mapping information for the corresponding class attributes.</P>

<P>In the point of view implementation, the Mappring Descriptor is a java object injected into the ObjectContentManager (see the interface org.apache.jackrabbit.ocm.mapper.Mapper). Right now, there are 2 different Mapping Descriptor implementations:</P>

<UL>
	<LI>Annotation : each persistent object is annoted in order to provide to the ObjectContentManager all the required information on its mapping strategy (see the class org.apache.jackrabbit.ocm.mapper.impl.annotation.AnnotationMapperImpl).</LI>
	<LI>XML configuration file : the class descriptors are defined in one or more XML config files used by the ObjectContentManager when it is instantiated (see the class org.apache.jackrabbit.ocm.mapper.impl.digester.DigesterMapperImpl).</LI>
</UL>


<P>For a business developer, it is not necessary to know how the ObjectContentManager is using the Class Descriptors. He has to make only a choice between annoted classes or XML files. Below, you can see how to setup correctly an ObjectContentManager. </P>

<H2><A name="ObjectContentManager-HowdoesanobjectispersistedintoaJCRrepository%3F"></A>How does an object is persisted into a JCR repository ?</H2>

<P>In all cases, a persistent object (a pojo) is mapped into a JCR node and its fields are mapped into subnodes or properties depending on their types.</P>

<P>There are 3 &quot;field types&quot;:</P>

<UL>
	<LI>Atomic fields<BR>
    Primitive data types and simple objects (String, Long, Double, ...) . Those fields are mapped into JCR properties. </LI>
</UL>


<UL>
	<LI>Bean fields<BR>
    One class can contain an 1..1 association to another bean. In this case, the field is a custom object. Those fields are mapped into JCR subnodes or a referenced node. </LI>
</UL>


<UL>
	<LI>Collection fields<BR>
    One class can contain an 1..n association to a collection of beans (or Map). Those fields are mapped into a collection of JCR subnodes or a collection of referenced nodes. It is also possible to map a java collection into a multivalue property. </LI>
</UL>


<P>The Mapping descriptor contains also information on inheritances, interface mapping strategy, lazy loading, custom converter, cache strategy, etc. </P>
<H2><A name="ObjectContentManager-Basicsetup%28withannotedpersistentclasses%29"></A>Basic setup (with annoted persistent classes)</H2>

<P>When you start your application, you need the following code to initialize correctly the Object Content Manager.</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">import</SPAN> javax.jcr.Session;
<SPAN class="code-keyword">import</SPAN> javax.jcr.Repository;
		      
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.manager.impl.ObjectContentManagerImpl;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.mapper.Mapper;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.mapper.impl.annotation.AnnotationMapperImpl;

		      
<SPAN class="code-comment">// 1. Instantiate a JCR session
</SPAN>Repository repository = ...;
Session session = repository.login(...);
		      
<SPAN class="code-comment">// 2. Register the different persistent classes
</SPAN>List classes = <SPAN class="code-keyword">new</SPAN> ArrayList();
classes.add(MyContent.class); <SPAN class="code-comment">// Call <SPAN class="code-keyword">this</SPAN> method <SPAN class="code-keyword">for</SPAN> each persistent class
</SPAN>
				      
<SPAN class="code-comment">// 3. Instantiate the object content manager
</SPAN>Mapper mapper = <SPAN class="code-keyword">new</SPAN> AnnotationMapperImpl(classes);
ObjectContentManager ocm = <SPAN class="code-keyword">new</SPAN> ObjectContentManagerImpl(session, mapper);
</PRE>
</DIV></DIV>

<H2><A name="ObjectContentManager-Basicsetup%28withoneormoreXMLMappingDescriptorfiles%29"></A>Basic setup (with one or more XML Mapping Descriptor files)</H2>

<P>When you start your application, you need the following code to initialize correctly the Object Content Manager.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">import</SPAN> javax.jcr.Session;
<SPAN class="code-keyword">import</SPAN> javax.jcr.Repository;

<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.mapper.Mapper;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.mapper.impl.digester.DigesterMapperImpl;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.manager.ObjectContentManager;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.manager.impl.ObjectContentManagerImpl;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.manager.atomictypeconverter.AtomicTypeConverterProvider;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.manager.atomictypeconverter.impl.DefaultAtomicTypeConverterProvider;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.manager.objectconverter.ObjectConverter;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.manager.objectconverter.impl.ObjectConverterImpl;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.query.QueryManager;
<SPAN class="code-keyword">import</SPAN> org.apache.jackrabbit.ocm.query.impl.QueryManagerImpl;

<SPAN class="code-comment">// 1. Instantiate a JCR session
</SPAN>Repository repository = ...;
Session session = repository.login(...);

<SPAN class="code-comment">// 2. Specify the different mapping files
</SPAN><SPAN class="code-object">String</SPAN>[] files = {
      <SPAN class="code-quote">&quot;./src/test-config/jcrmapping.xml&quot;</SPAN>,
      <SPAN class="code-quote">&quot;./src/test-config/jcrmapping-atomic.xml&quot;</SPAN>,
      <SPAN class="code-quote">&quot;./src/test-config/jcrmapping-beandescriptor.xml&quot;</SPAN>
  };

<SPAN class="code-comment">// 3. Instantiate the object content manager
</SPAN>ObjectContentManager ocm = <SPAN class="code-keyword">new</SPAN> ObjectContentManagerImpl(session, files);

</PRE>
</DIV></DIV>


<H2><A name="ObjectContentManager-APIOverview"></A>API Overview</H2>

<P>With the current Object Manager API, it is possible to:</P>

<UL>
	<LI>Manage the object life cycle (insert, update, delete, retrieve). See <A href="basic-ocm-operations.html" title="Basic OCM operations">Basic OCM operations</A>.</LI>
	<LI>Search single object or collections with criteria. See <A href="ocm-search.html" title="OCM Search">OCM Search</A>.</LI>
	<LI>Lock objects. See <A href="ocm-locking.html" title="OCM Locking">OCM Locking</A>.</LI>
	<LI>Manage versions (check int, check out, create a new version, show history). See <A href="ocm-version-management.html" title="OCM Version Management">OCM Version Management</A>.</LI>
</UL>


<P>We plan to add other features in a future release. </P>
        </DIV>
        <DIV id="end"></DIV>
      </DIV>
      <DIV id="footer">
        <P>
          &copy; 2004-2010 The Apache Software Foundation.
          - <A href="http://jackrabbit.apache.org/privacy-policy.html">Privacy Policy</A> -
          [<A href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=75349">edit this page</A>]
          <BR>
          Apache Jackrabbit, Jackrabbit, Apache, the Apache feather logo, and the Apache
          Jackrabbit project logo are trademarks of The Apache Software Foundation.
        </P>
      </DIV>
    </DIV>
<!-- JCR- 1315: Add Google Analytics to Jackrabbit web site -->
<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
var pageTracker = _gat._getTracker("UA-837900-2");
pageTracker._initData();
pageTracker._trackPageview();
</SCRIPT>
  </BODY>
</HTML>
